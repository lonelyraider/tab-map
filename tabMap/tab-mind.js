(()=>{var t,e,i,s,n,r=Object.defineProperty,o=t=>r(t,"__esModule",{value:!0}),a=(t,e)=>{for(var i in o(t),e)r(t,i,{get:e[i],enumerable:!0})};function l(t,e){let i=document.createElement(t);return Object.assign(i,e),i}var h="http://www.w3.org/2000/svg";function c(t,e){let i=document.createElementNS(h,t);for(let s in e)i.setAttribute(s,e[s]);return i}function d(){return c("g")}function u(){let t=c("foreignObject");return t.setAttribute("width","1"),t.setAttribute("height","1"),t}var p=new Map;function f(t,e,i){(p.get(t)||[]).forEach(s=>{"function"==typeof s?s(t,e,i):s.handleMessage(t,e,i)})}function m(t,e){p.has(t)||p.set(t,[]);let i=p.get(t)||[];-1==i.indexOf(e)&&i.push(e)}function g(t,e){let i=p.get(t)||[],s=i.indexOf(e);s>-1&&i.splice(s,1)}var v=0,y=[];function x(){v=0,y=[]}function w(t){v<y.length&&y.splice(v,y.length-v),y.push(t),v++}function $(){y[--v].undo()}function b(){y[v++].do()}function _(){return!!v}function S(){return v!=y.length}var C={};a(C,{close:()=>N,init:()=>L,toggle:()=>E});var k=document.querySelector("#help"),A={Enter:"↩",Space:"Spacebar",ArrowLeft:"←",ArrowUp:"↑",ArrowRight:"→",ArrowDown:"↓","-":"−"};function E(){k.hidden=!k.hidden}function L(){let t=k.querySelector(".navigation");I(t,"pan"),I(t,"select"),I(t,"select-root"),I(t,"select-parent"),I(t,"center"),I(t,"zoom-in","zoom-out"),I(t,"fold"),I(t=k.querySelector(".manipulation"),"insert-sibling"),I(t,"insert-child"),I(t,"swap"),I(t,"side"),I(t,"delete"),I(t=k.querySelector(".editing"),"value"),I(t,"yes","no","computed"),I(t,"edit"),I(t,"newline"),I(t,"bold"),I(t,"italic"),I(t,"underline"),I(t,"strikethrough"),I(t=k.querySelector(".other"),"undo","redo"),I(t,"save"),I(t,"save-as"),I(t,"load"),I(t,"help"),I(t,"notes"),I(t,"ui")}function I(t,...e){var i=t.insertRow(-1);let s=[],n=[];e.forEach(t=>{let e=il.get(t);if(!e){console.warn(t);return}s.push(e.label),n=n.concat(e.keys.map(T))}),i.insertCell(-1).textContent=s.join("/"),i.insertCell(-1).textContent=n.join("/")}function T(t){var e="";if(t.ctrlKey&&(e+="Ctrl+"),t.altKey&&(e+="Alt+"),t.shiftKey&&(e+="Shift+"),t.key){let i=t.key;e+=A[i]||i.toUpperCase()}if(t.code){let s=t.code;s.startsWith("Key")?e+=s.substring(3):e+=A[s]||s}return e}function N(){k.hidden=!0}var D={};a(D,{close:()=>q,init:()=>R,toggle:()=>M});var K=document.querySelector("#notes"),O=K.querySelector("iframe");function M(){K.hidden=!K.hidden}function q(){!K.hidden&&(K.hidden=!0)}function V(t){if(t.data&&t.data.action)switch(t.data.action){case"setContent":n.notes=t.data.value.trim();break;case"closeEditor":q()}}function R(){m("item-select",(t,e)=>{O.contentWindow&&O.contentWindow.postMessage({action:"setContent",value:e.notes},"*")}),window.addEventListener("message",V)}var z={};a(z,{init:()=>tn});var B=class{do(){}undo(){}},H=class extends B{constructor(t){super(),this.actions=t}do(){this.actions.forEach(t=>t.do())}undo(){this.actions.slice().reverse().forEach(t=>t.undo())}},P=class extends B{constructor(t,e){super(),this.parent=t,this.index=e,this.item=new iu}do(){this.parent.collapsed=!1,this.parent.insertChild(this.item,this.index),i5(this.item)}undo(){this.parent.removeChild(this.item),i5(this.parent)}},j=class extends B{constructor(t,e){super(),this.parent=t,this.item=e}do(){this.parent.insertChild(this.item),i5(this.item)}undo(){this.parent.removeChild(this.item),i5(this.parent)}},J=class extends B{constructor(t){super(),this.item=t,this.parent=t.parent,this.index=this.parent.children.indexOf(this.item)}do(){this.parent.removeChild(this.item),i5(this.parent)}undo(){this.parent.insertChild(this.item,this.index),i5(this.item)}},F=class extends B{constructor(t,e,i,s=null){super(),this.item=t,this.newParent=e,this.newIndex=i,this.newSide=s,this.oldParent=t.parent,this.oldIndex=this.oldParent.children.indexOf(t),this.oldSide=t.side}do(){let{item:t,newParent:e,newIndex:i,newSide:s}=this;t.side=s,void 0===i?e.insertChild(t):e.insertChild(t,i),i5(t)}undo(){let{item:t,oldSide:e,oldIndex:i,oldParent:s,newParent:n}=this;t.side=e,s.insertChild(t,i),i5(n)}},W=class extends B{constructor(t,e){super(),this.item=t,this.parent=t.parent;let i=this.parent.children,s=this.parent.resolvedLayout.pickSibling(t,e);this.sourceIndex=i.indexOf(t),this.targetIndex=i.indexOf(s)}do(){this.parent.insertChild(this.item,this.targetIndex)}undo(){this.parent.insertChild(this.item,this.sourceIndex)}},U=class extends B{constructor(t,e){super(),this.item=t,this.layout=e,this.oldLayout=t.layout}do(){this.item.layout=this.layout}undo(){this.item.layout=this.oldLayout}},G=class extends B{constructor(t,e){super(),this.item=t,this.shape=e,this.oldShape=t.shape}do(){this.item.shape=this.shape}undo(){this.item.shape=this.oldShape}},Y=class extends B{constructor(t,e){super(),this.item=t,this.color=e,this.oldColor=t.color}do(){this.item.color=this.color}undo(){this.item.color=this.oldColor}},X=class extends B{constructor(t,e){super(),this.item=t,this.textColor=e,this.oldTextColor=t.textColor}do(){this.item.textColor=this.textColor}undo(){this.item.textColor=this.oldTextColor}},Z=class extends B{constructor(t,e){super(),this.item=t,this.text=e,this.oldText=t.text,this.oldValue=t.value}do(){this.item.text=this.text,console.log("here is text pranita",this.text);let t=Number(this.text);String(t)==this.text&&(this.item.value=t)}undo(){this.item.text=this.oldText,this.item.value=this.oldValue}},Q=class extends B{constructor(t,e){super(),this.item=t,this.value=e,this.oldValue=t.value}do(){this.item.value=this.value}undo(){this.item.value=this.oldValue}},tt=class extends B{constructor(t,e){super(),this.item=t,this.status=e,this.oldStatus=t.status}do(){this.item.status=this.status}undo(){this.item.status=this.oldStatus}},te=class extends B{constructor(t,e){super(),this.item=t,this.icon=e,this.oldIcon=t.icon}do(){this.item.icon=this.icon}undo(){this.item.icon=this.oldIcon}},ti=class extends B{constructor(t,e){super(),this.item=t,this.side=e,this.oldSide=t.side}do(){this.item.side=this.side,this.item.update({children:!0})}undo(){this.item.side=this.oldSide,this.item.update({children:!0})}},ts=document.querySelector("#color");function tn(){ts.addEventListener("click",tr),[...ts.querySelectorAll("[data-color]")].forEach(t=>{t.style.backgroundColor=t.dataset.color})}function tr(t){t.preventDefault();let e=t.target.dataset.color||"",i=new Y(n,e);i6(i)}var to={};a(to,{init:()=>tl});var ta=document.querySelector("#text-color");function tl(){ta.addEventListener("click",th),[...ta.querySelectorAll("[data-color]")].forEach(t=>{t.style.backgroundColor=t.dataset.color})}function th(t){t.preventDefault();let e=t.target.dataset.color||"",i=new X(n,e);i6(i)}var tc={};a(tc,{init:()=>tu,update:()=>tp});var td=document.querySelector("#value");function tu(){td.addEventListener("change",tf)}function tp(){let t=n.value;null===t&&(t=""),"number"==typeof t&&(t="num"),td.value=t}function tf(){let t=td.value;if("num"==t)il.get("value").execute();else{let e=new Q(n,t||null);i6(e)}}var tm={};a(tm,{init:()=>tE,update:()=>tL});var tg={left:"right",right:"left",top:"bottom",bottom:"top"},tv=class{constructor(t,e,i="right"){this.id=t,this.label=e,this.childDirection=i,this.SPACING_CHILD=4,ty.set(this.id,this)}get option(){return new Option(this.label,this.id)}getChildDirection(t){return this.childDirection}computeAlignment(t){return"left"==(t.isRoot?this.childDirection:t.parent.resolvedLayout.getChildDirection(t))?"right":"left"}pick(t,e){if(!t.collapsed)for(var i=t.children,s=0;s<i.length;s++){var n=i[s];if(this.getChildDirection(n)==e)return n}if(t.isRoot)return t;let r=t;var o=r.parent.resolvedLayout,a=o.getChildDirection(t);return a==e?r:a==tg[e]?r.parent:o.pickSibling(r,"left"==e||"top"==e?-1:1)}pickSibling(t,e){if(t.isRoot)return t;var i=t.parent.children,s=i.indexOf(t);return s+=e,i[s=(s+i.length)%i.length]}positionToggle(t,e){t.dom.toggle.setAttribute("transform",`translate(${e.map(Math.round)})`)}getChildAnchor(t,e){let{position:i,contentPosition:s,contentSize:n}=t;if("left"==e||"right"==e){var r=i[0]+s[0];"left"==e&&(r+=n[0])}else{var r=i[1]+s[1];"top"==e&&(r+=n[1])}return r}computeChildrenBBox(t,e){let i=[0,0];var s=(e+1)%2;return t.forEach(t=>{let{size:n}=t;i[s]=Math.max(i[s],n[s]),i[e]+=n[e]}),t.length>1&&(i[e]+=this.SPACING_CHILD*(t.length-1)),i}},ty=new Map,tx=16,tw=tx/2,t$=class extends tv{update(t){let e=this.layoutItem(t,this.childDirection);"left"==this.childDirection||"right"==this.childDirection?this.drawLinesHorizontal(t,this.childDirection):this.drawLinesVertical(t,this.childDirection,e)}layoutItem(t,e){let{contentSize:i,children:s}=t,n="left"==e||"right"==e?0:1,r=(n+1)%2,o=i[n],a=i[r];if(!t.collapsed&&s.length>0){let l=this.computeChildrenBBox(s,r);o+=l[n]+tx,a=Math.max(a,l[r]);let h=[0,0];"right"==e&&(h[0]=i[0]+tx),"bottom"==e&&(h[1]=i[1]+tx),h[r]=Math.round((a-l[r])/2),this.layoutChildren(s,e,h,l)}let c=0;"left"==e&&(c=o-i[0]),"top"==e&&(c=o-i[1]);let d=[Math.round((a-i[r])/2),c];return 0==n&&(d=d.reverse()),t.contentPosition=d,0==n?a:o}layoutChildren(t,e,i,s){var n=(("left"==e||"right"==e?0:1)+1)%2;return t.forEach(t=>{let{size:r}=t;"left"==e&&(i[0]=s[0]-r[0]),"top"==e&&(i[1]=s[1]-r[1]),t.position=i,i[n]+=r[n]+this.SPACING_CHILD}),s}drawLinesHorizontal(t,e){let{contentPosition:i,contentSize:s,resolvedShape:n,resolvedColor:r,children:o,dom:a}=t;if(0==o.length)return;let l="right"==e?1:-1,h=[i[0]+("right"==e?s[0]:0)+.5*l,n.getVerticalAnchor(t)],d=[h[0]+l*tw,h[1]];if(this.positionToggle(t,d),t.collapsed)return;let u=[];if(1==o.length){var p=o[0];let{position:f,resolvedShape:m}=p,g=[this.getChildAnchor(p,e),m.getVerticalAnchor(p)+f[1]],v=(h[0]+g[0])/2;u.push(`M ${h}`,`C ${[v,h[1]]} ${[v,g[1]]} ${g}`);let y=c("path",{d:u.join(" "),stroke:r,fill:"none"});a.connectors.append(y);return}u.push(`M ${h}`,`L ${d}`);let x=o[0],w=o[o.length-1],$=d[0]+l*tw,b=l>0?0:1,_=[this.getChildAnchor(x,e),x.resolvedShape.getVerticalAnchor(x)+x.position[1]],S=[this.getChildAnchor(w,e),w.resolvedShape.getVerticalAnchor(w)+w.position[1]];u.push(`M ${_}`,`L ${$} ${_[1]}`,`A ${tw} ${tw} 0 0 ${b} ${d[0]} ${_[1]+tw}`,`L ${d[0]} ${S[1]-tw}`,`A ${tw} ${tw} 0 0 ${b} ${$} ${S[1]}`,`L ${S}`);for(let C=1;C<o.length-1;C++){let k=o[C],A=k.resolvedShape.getVerticalAnchor(k)+k.position[1],E=[d[0],A],L=[this.getChildAnchor(k,e),A];u.push(`M ${E}`,`L ${L}`)}let I=c("path",{d:u.join(" "),stroke:r,fill:"none"});a.connectors.append(I)}drawLinesVertical(t,e,i){let{contentSize:s,resolvedShape:n,resolvedColor:r,children:o,dom:a}=t;if(0==o.length)return;let l="bottom"==e?1:-1,h=[n.getHorizontalAnchor(t),"bottom"==e?n.getVerticalAnchor(t):i-s[1]],d=[h[0],("bottom"==e?s[1]:h[1])+(tw*l+.5)];if(this.positionToggle(t,d),t.collapsed)return;let u=[];if(u.push(`M ${h}`,`L ${d}`),1==o.length){let p=o[0],f=[d[0],this.getChildAnchor(p,e)];u.push(`M ${d}`,`L ${f}`);let m=c("path",{d:u.join(" "),stroke:r,fill:"none"});a.connectors.append(m);return}let g=o[0],v=o[o.length-1],y=d[1]+l*tw,x=l>0?1:0,w=[g.resolvedShape.getHorizontalAnchor(g)+g.position[0],this.getChildAnchor(g,e)],$=[v.resolvedShape.getHorizontalAnchor(v)+v.position[0],this.getChildAnchor(v,e)];u.push(`M ${w}`,`L ${w[0]} ${y}`,`A ${tw} ${tw} 0 0 ${x} ${w[0]+tw} ${d[1]}`,`L ${$[0]-tw} ${d[1]}`,`A ${tw} ${tw} 0 0 ${x} ${$[0]} ${y}`,`L ${$}`);for(var b=1;b<o.length-1;b++){let _=o[b],S=_.resolvedShape.getHorizontalAnchor(_)+_.position[0],C=[S,d[1]],k=[S,this.getChildAnchor(_,e)];u.push(`M ${C}`,`L ${k}`)}let A=c("path",{d:u.join(" "),stroke:r,fill:"none"});a.connectors.append(A)}};new t$("graph-bottom","Bottom","bottom"),new t$("graph-top","Top","top"),new t$("graph-left","Left","left"),new t$("graph-right","Right","right");var tb,t_=32,tS=t_/4,tC=t_/2,tk=class extends tv{update(t){let e=this.layoutItem(t,this.childDirection);this.drawLines(t,this.childDirection,e)}layoutItem(t,e){let{contentSize:i,children:s}=t,n=i[0];if(!t.collapsed&&s.length>0){let r=this.computeChildrenBBox(s,1);n=Math.max(n,r[0]+t_);let o=[t_,i[1]+this.SPACING_CHILD];"left"==e&&(o[0]=n-r[0]-t_),this.layoutChildren(s,e,o,r)}let a=0;return"left"==e&&(a=n-i[0]),t.contentPosition=[a,0],n}layoutChildren(t,e,i,s){t.forEach(t=>{let{size:n}=t,r=i[0];"left"==e&&(r+=s[0]-n[0]),t.position=[r,i[1]],i[1]+=n[1]+this.SPACING_CHILD})}drawLines(t,e,i){let{resolvedShape:s,resolvedColor:n,children:r,dom:o}=t,a="right"==e?1:-1,l=("left"==e?i-tC:tC)+.5,h=[l,s.getVerticalAnchor(t)];if(this.positionToggle(t,[h[0],h[1]+(ic+2)]),0==r.length||t.collapsed)return;let d=r[r.length-1],u=[l,d.resolvedShape.getVerticalAnchor(d)+d.position[1]-tS],p=[`M ${h}`,`L ${u}`],f=a>0?0:1;r.forEach(t=>{let{resolvedShape:i,position:s}=t,n=i.getVerticalAnchor(t)+s[1];p.push(`M ${l} ${n-tS}`,`A ${tS} ${tS} 0 0 ${f} ${l+a*tS} ${n}`,`L ${this.getChildAnchor(t,e)} ${n}`)});let m=c("path",{d:p.join(" "),stroke:n,fill:"none"});o.connectors.append(m)}};new tk("tree-left","Left","left"),new tk("tree-right","Right","right"),new class extends t${constructor(){super(...arguments),this.LINE_THICKNESS=8}update(t){if(t.isRoot)this.layoutRoot(t);else{var e=this.getChildDirection(t);ty.get(`graph-${e}`).update(t)}}getChildDirection(t){for(;!t.parent.isRoot;)t=t.parent;let e=t.side;if(e)return e;let i={left:0,right:0};return t.parent.children.forEach(t=>{let e=t.side;e||(e=i.right>i.left?"left":"right",t.side=e),i[e]++}),t.side}pickSibling(t,e){if(t.isRoot)return t;let i=t.parent;var s=i.children;if(i.isRoot){var n=this.getChildDirection(t);s=s.filter(t=>this.getChildDirection(t)==n)}var r=s.indexOf(t);return r+=e,s[r=(r+s.length)%s.length]}layoutRoot(t){let{children:e,contentSize:i}=t,s=[],n=[],r=[0,0];e.forEach(t=>{"left"==this.getChildDirection(t)?s.push(t):n.push(t)});let o=this.computeChildrenBBox(s,1),a=this.computeChildrenBBox(n,1),l=Math.max(o[1],a[1],i[1]),h=0;this.layoutChildren(s,"left",[h,Math.round((l-o[1])/2)],o),h+=o[0],s.length&&(h+=tx),r[0]=h,h+=i[0],n.length&&(h+=tx),this.layoutChildren(n,"right",[h,Math.round((l-a[1])/2)],a),h+=a[0],r[1]=Math.round((l-i[1])/2),t.contentPosition=r,this.drawRootConnectors(t,"left",s),this.drawRootConnectors(t,"right",n)}drawRootConnectors(t,e,i){if(0==i.length||t.collapsed)return;let{contentSize:s,contentPosition:n,resolvedShape:r,dom:o}=t,a=n[0]+s[0]/2,l=r.getVerticalAnchor(t),h=this.LINE_THICKNESS/2,d=i.map(t=>{let{resolvedColor:i,resolvedShape:s,position:n}=t,r=this.getChildAnchor(t,e),o=s.getVerticalAnchor(t)+n[1],d=Math.atan2(o-l,r-a)+Math.PI/2,u=Math.cos(d)*h,p=Math.sin(d)*h,f={d:`M ${a-u} ${l-p} Q ${(r+a)/2} ${o} ${r} ${o} Q ${(r+a)/2} ${o} ${a+u} ${l+p} Z`,fill:i,stroke:i};return c("path",f)});o.connectors.append(...d)}}("map","Map");var tA=document.querySelector("#layout");function tE(){let t=ty.get("map");tA.append(t.option);let e=tI("Graph"),i=["right","left","bottom","top"].map(t=>ty.get(`graph-${t}`).option);e.append(...i),e=tI("Tree");let s=["right","left"].map(t=>ty.get(`tree-${t}`).option);e.append(...s),tA.addEventListener("change",t9)}function tL(){var t="",e=n.layout;e&&(t=e.id),tA.value=t,t8("").disabled=n.isRoot,t8("map").disabled=!n.isRoot}function t9(){let t=ty.get(tA.value);var e=new U(n,t);i6(e)}function t8(t){return tA.querySelector(`option[value="${t}"]`)}function tI(t){let e=document.createElement("optgroup");return e.label=t,tA.append(e),e}var tT={};a(tT,{init:()=>tD,update:()=>tK});var tN=document.querySelector("#icons");function tD(){tN.addEventListener("change",t0)}function tK(){tN.value=n.icon||""}function t0(){let t=new te(n,tN.value);i6(t)}var tO={};a(tO,{init:()=>tj,update:()=>tJ});var tM,tq=.5,tV=class{constructor(t,e){this.id=t,this.label=e,tR.set(this.id,this)}get option(){return new Option(this.label,this.id)}update(t){t.dom.content.style.borderColor=t.resolvedColor}getHorizontalAnchor(t){let{contentPosition:e,contentSize:i}=t;return Math.round(e[0]+i[0]/2)+.5}getVerticalAnchor(t){let{contentPosition:e,contentSize:i}=t;return e[1]+Math.round(i[1]*tq)+.5}},tR=new Map,tz=class extends tV{constructor(){super("box","Box")}};new tz,new class extends tV{constructor(){super("ellipse","Ellipse")}};var tB,tH=-4;new class extends tV{constructor(){super("underline","Underline")}update(t){let{contentPosition:e,resolvedColor:i,contentSize:s,dom:n}=t,r=e[0],o=r+s[0],a=this.getVerticalAnchor(t),l=c("path",{d:`M ${r} ${a} L ${o} ${a}`,stroke:i,fill:"none"});n.connectors.append(l)}getVerticalAnchor(t){let{contentPosition:e,contentSize:i}=t;return e[1]+i[1]+tH+.5}};var tP=document.querySelector("#shape");function tj(){tR.forEach(t=>tP.append(t.option)),tP.addEventListener("change",tF)}function tJ(){let t="",e=n.shape;e&&(t=e.id),tP.value=t}function tF(){let t=tR.get(tP.value),e=new G(n,t);i6(e)}var tW={};a(tW,{init:()=>t7,update:()=>t1});var tU=document.querySelector("#status"),t4={yes:!0,no:!1,"":null};function t3(t){for(let e in t4)if(t4[e]===t)return e;return String(t)}function tG(t){return t in t4?t4[t]:t}function t7(){tU.addEventListener("change",tY)}function t1(){tU.value=t3(n.status)}function tY(){let t=tG(tU.value),e=new tt(n,t);i6(e)}var t6={};a(t6,{init:()=>tX});var t5=document.querySelector("#tip");function tX(){t5.addEventListener("click",tZ),m("command-child",tZ),m("command-sibling",tZ)}function tZ(){g("command-child",tZ),g("command-sibling",tZ),t5.removeEventListener("click",tZ),t5.hidden=!0}var t2={};a(t2,{hide:()=>e4,init:()=>eJ,isActive:()=>ej,quickSave:()=>e3,restore:()=>eW,show:()=>eU});var tQ=class{constructor(t,e){this.backend=t,this.label=e,this.mode="load",et.set(this.id,this),this.prefix=`mm.app.${this.id}`;let{go:i,cancel:s}=this;s.addEventListener("click",t=>e4()),i.addEventListener("click",t=>this.submit())}get id(){return this.backend.id}get node(){return document.querySelector(`#${this.id}`)}get cancel(){return this.node.querySelector(".cancel")}get go(){return this.node.querySelector(".go")}get option(){return new Option(this.label,this.id)}reset(){this.backend.reset()}setState(t){}getState(){return{}}show(t){this.mode=t;let{go:e,node:i}=this;e.textContent=t.charAt(0).toUpperCase()+t.substring(1),[...i.querySelectorAll("[data-for]")].forEach(t=>t.hidden=!0),[...i.querySelectorAll(`[data-for~=${t}]`)].forEach(t=>t.hidden=!1),e.focus()}saveDone(){iX(!1),f("save-done",this)}loadDone(t){iX(!1);try{iY(i_.fromJSON(t)),f("load-done",this)}catch(e){this.error(e)}}error(t){iX(!1);alert(`IO error: ${t instanceof Error?t.message:t}`)}submit(){switch(this.mode){case"save":this.save();break;case"load":this.load()}}},et=new Map;function ee(t,e){let i=[];for(let s in t)i.push({id:s,name:t[s]});i.sort((t,e)=>t.name.localeCompare(e.name));let n=i.map(t=>new Option(t.name,t.id));e.append(...n)}var ei=class{constructor(t){this.id=t,es.set(t,this)}reset(){}},es=new Map,en=class extends ei{constructor(){super("local"),this.prefix="mm.map"}save(t,e,i){localStorage.setItem(`${this.prefix}.${e}`,t);let s=this.list();s[e]=i,localStorage.setItem(`${this.prefix}.names`,JSON.stringify(s))}load(t){let e=localStorage.getItem(`${this.prefix}.${t}`);if(!e)throw Error("There is no such saved map");return e}remove(t){localStorage.removeItem(`${this.prefix}.${t}`);let e=this.list();delete e[t],localStorage.setItem(`${this.prefix}.names`,JSON.stringify(e))}list(){try{let t=localStorage.getItem(`${this.prefix}.names`)||"{}";return JSON.parse(t)}catch(e){return{}}}},er=class{constructor(t,e){this.id=t,this.label=e,eo.set(t,this)}get option(){return new Option(this.label,this.id)}},eo=new Map;function ea(t,e){return[...eo.values()].filter(i=>i[t]==e)[0]||null}function el(t){let e=t.lastIndexOf(".");return -1==e?null:ea("extension",t.substring(e+1).toLowerCase())}function eh(t){return ea("mime",t)}function ec(t){return t.replace(/\n/g,"<br/>")}function ed(t){return t.replace(/<br\s*\/?>/g,"\n")}var eu=class extends tQ{constructor(){super(new en,"Browser storage"),this.remove.addEventListener("click",t=>{var e=this.list.value;e&&(this.backend.remove(e),this.show(this.mode))})}get list(){return this.node.querySelector(".list")}get remove(){return this.node.querySelector(".remove")}show(t){super.show(t);let{go:e,remove:i,list:s}=this;if(e.disabled=!1,"load"==t){let n=this.backend.list();if(s.innerHTML="",Object.keys(n).length)e.disabled=!1,i.disabled=!1,ee(n,this.list);else{this.go.disabled=!0,this.remove.disabled=!0;let r=document.createElement("option");r.innerHTML="(no maps saved)",this.list.append(r)}}}setState(t){this.load(t.id)}getState(){return{b:this.id,id:s.id}}save(){let t=s.toJSON(),e=eo.get("native").to(t);try{this.backend.save(e,s.id,s.name),this.saveDone()}catch(i){this.error(i)}}load(t=this.list.value){try{let e=this.backend.load(t);var i=eo.get("native").from(e);this.loadDone(i)}catch(s){this.error(s)}}},ep=class extends ei{constructor(){super("file"),this.input=document.createElement("input")}save(t,e){let i=document.createElement("a");i.download=e,i.href="data:text/plain;base64,"+btoa(unescape(encodeURIComponent(t))),document.body.append(i),i.click(),i.remove()}load(){let{input:t}=this;return t.type="file",new Promise((e,i)=>{t.onchange=s=>{let n=t.files[0];if(n){var r=new FileReader;r.onload=function(){e({data:r.result,name:n.name})},r.onerror=function(){i(r.error)},r.readAsText(n)}},t.click()})}},ef=class extends er{constructor(){super("native","Native (JSON)"),this.extension="mymind",this.mime="application/vnd.mymind+json"}to(t){return JSON.stringify(t,null,"	")+"\n"}from(t){return JSON.parse(t)}},em=class extends er{constructor(t="freemind",e="FreeMind"){super(t,e),this.extension="mm",this.mime="application/x-freemind"}to(t){var e=document.implementation.createDocument(null,null,null),i=e.createElement("map");return i.setAttribute("version","1.0.1"),i.appendChild(this.serializeItem(e,t.root)),e.appendChild(i),new XMLSerializer().serializeToString(e)}from(t){var e=new DOMParser().parseFromString(t,"application/xml");if("parsererror"==e.documentElement.nodeName.toLowerCase())throw Error(e.documentElement.textContent||"");var i=e.documentElement.getElementsByTagName("node")[0];if(!i)throw Error("No root node found");var s={root:this.parseNode(i,{shape:"underline"})};return s.root.layout="map",s.root.shape="ellipse",s}serializeItem(t,e){var i=this.serializeAttributes(t,e);return(e.children||[]).forEach(e=>{i.appendChild(this.serializeItem(t,e))}),i}serializeAttributes(t,e){var i=t.createElement("node");if(i.setAttribute("TEXT",ed(e.text)),e.id&&i.setAttribute("ID",e.id),e.side&&i.setAttribute("POSITION",e.side),"box"==e.shape&&i.setAttribute("STYLE","bubble"),e.collapsed&&i.setAttribute("FOLDED","true"),e.notes){var s=t.createElement("richcontent");s.setAttribute("TYPE","NOTE"),s.appendChild(t.createCDATASection("<html><head></head><body>"+e.notes+"</body></html>")),i.appendChild(s)}return i}parseNode(t,e){for(var i=this.parseAttributes(t,e),s=0;s<t.childNodes.length;s++){var n=t.childNodes[s];n instanceof Element&&"node"==n.nodeName.toLowerCase()&&i.children.push(this.parseNode(n,i))}return i}parseAttributes(t,e){var i={children:[],text:ec(t.getAttribute("TEXT")||""),id:t.getAttribute("ID")},s=t.getAttribute("POSITION");s&&(i.side=s),"bubble"==t.getAttribute("STYLE")?i.shape="box":i.shape=e.shape,"true"==t.getAttribute("FOLDED")&&(i.collapsed=1);for(var n=t.children,r=0;r<n.length;r++){var o=n[r];switch(o.nodeName.toLowerCase()){case"richcontent":if("NOTE"==o.getAttribute("TYPE")){var a=o.querySelector("body > *");if(a){var l=new XMLSerializer;i.notes=l.serializeToString(a).trim()}}break;case"font":"true"==o.getAttribute("ITALIC")&&(i.text="<i>"+i.text+"</i>"),"true"==o.getAttribute("BOLD")&&(i.text="<b>"+i.text+"</b>")}}return i}},eg=class extends em{constructor(){super("mma","Mind Map Architect"),this.extension="mma",this.serializeAttributes=function(t,e){var i=t.createElement("node");if(i.setAttribute("title",ed(e.text)),i.setAttribute("expand",e.collapsed?"false":"true"),e.side&&i.setAttribute("direction","left"==e.side?"0":"1"),e.color){var s=e.color.match(/^#(.)(.)(.)$/),n=[,,,,,].join(s[1]),r=[,,,,,].join(s[2]),o=[,,,,,].join(s[3]);i.setAttribute("color","#"+[n,r,o].join(""))}return e.icon&&i.setAttribute("icon",e.icon),i}}parseAttributes(t,e){var i={children:[],text:ec(t.getAttribute("title")||""),shape:"box"};"false"==t.getAttribute("expand")&&(i.collapsed=1);var s=t.getAttribute("direction");"0"==s&&(i.side="left"),"1"==s&&(i.side="right");var n=t.getAttribute("color");if(n){var r=n.match(/^#(....)(....)(....)$/);if(r){let o=r.slice(1).map(t=>parseInt(t,16)>>8).map(t=>Math.round(t/17)).map(t=>t.toString(16));i.color="#"+o.join("")}}return i.icon=t.getAttribute("icon")||"",i}},ev=class extends er{constructor(){super("mup","MindMup"),this.extension="mup"}to(t){return JSON.stringify(ex(t.root),null,2)}from(t){var e=JSON.parse(t),i=ey(e);return i.layout="map",{root:i}}};function ey(t){var e={text:ec(t.title),id:t.id,shape:"box",icon:t.icon};if(t.attr&&t.attr.style&&t.attr.style.background&&(e.color=t.attr.style.background),t.attr&&t.attr.collapsed&&(e.collapsed=1),t.ideas){var i=[];for(var s in t.ideas){var n=ey(t.ideas[s]),r=parseFloat(s);n.side=r<0?"left":"right",i.push({child:n,num:r})}i.sort(function(t,e){return t.num-e.num}),e.children=i.map(t=>t.child)}return e}function ex(t,e){var i={id:t.id,title:ed(t.text),icon:t.icon,attr:{}};if(t.color&&(i.attr.style={background:t.color}),t.collapsed&&(i.attr.collapsed=!0),t.children){i.ideas={};for(var s=0;s<t.children.length;s++){var n=t.children[s],r=e||n.side,o=s+1;"left"==r&&(o*=-1),i.ideas[o]=ex(n,r)}}return i}var ew=class extends er{constructor(){super("plaintext","Plain text"),this.extension="txt",this.mime="application/vnd.mymind+txt"}to(t){return e$("root"in t?t.root:t)}from(t){var e=eb(t.split("\n").filter(function(t){return t.match(/\S/)}));let i;return(i=1==e.length?{root:e[0]}:{root:{text:"",children:e}}).root.layout="map",i}};function e$(t,e=0){var i=(t.children||[]).map(t=>e$(t,e+1)),s=Array(e+1).join("	");return i.unshift(s+t.text.replace(/\n/g,"")),i.join("\n")+(e?"":"\n")}function eb(t){let e=[];if(!t.length)return e;var i=e_(t[0]);let s=null,n=[];var r=function(){if(s&&n.length){var t=eb(n);t.length&&(s.children=t),n=[]}};return t.forEach(t=>{e_(t)==i?(r(),s={text:t.match(/^\s*(.*)/)[1]},e.push(s)):n.push(t)}),r(),e}function e_(t){return t.match(/^\s*/)[0]}var eS=[ef,em,eg,ev,ew].map(t=>new t);function eC(t){let e=eS.map(t=>t.option);t.append(...e)}var ek,eA=class extends tQ{constructor(){super(new ep,"File"),eC(this.format),this.format.value=localStorage.getItem(this.prefix+"format")||"native"}get format(){return this.node.querySelector(".format")}show(t){super.show(t),this.go.textContent="save"==t?"Save":"Browse"}save(){let t=eo.get(this.format.value);var e=s.toJSON(),i=t.to(e),n=s.name+"."+t.extension;try{this.backend.save(i,n),this.saveDone()}catch(r){this.error(r)}}async load(){try{let t=await this.backend.load(),e=(el(t.name)||eo.get("native")).from(t.data);this.loadDone(e)}catch(i){this.error(i)}}submit(){localStorage.setItem(`${this.prefix}.format`,this.format.value),super.submit()}},eE=class extends tQ{constructor(){super(new class extends ei{constructor(){super("webdav")}save(t,e){return this.request("PUT",e,t)}load(t){return this.request("GET",t)}async request(t,e,i){let s={method:t,credentials:"include"};i&&(s.body=i);let n=await fetch(e,s),r=await n.text();if(n.ok)return r;throw Error(`HTTP/${n.status}
  
  ${r}`)}},"Generic WebDAV"),this.current="",this.url.value=localStorage.getItem(`${this.prefix}.url`)||""}get url(){return this.node.querySelector(".url")}getState(){return{url:this.current}}setState(t){this.load(t.url)}async save(){iX(!0);var t=s,e=this.url.value;localStorage.setItem(`${this.prefix}.url`,e),e.match(/\.mymind$/)||("/"!=e.charAt(e.length-1)&&(e+="/"),e+=`${t.name}.${eo.get("native").extension}`),this.current=e;let i=t.toJSON(),n=eo.get("native").to(i);try{await this.backend.save(n,e),this.saveDone()}catch(r){this.error(r)}}async load(t=this.url.value){this.current=t,iX(!0);var e=t.lastIndexOf("/");this.url.value=t.substring(0,e),localStorage.setItem(`${this.prefix}.url`,this.url.value);try{let i=await this.backend.load(t),s=eo.get("native").from(i);this.loadDone(s)}catch(n){this.error(n)}}},eL=class extends ei{constructor(){super("image")}async save(t){let e=new XMLSerializer,i=new TextEncoder,n=e.serializeToString(s.node),r,o=`data:image/svg+xml;base64,${btoa([...i.encode(n)].map(t=>String.fromCharCode(t)).join(""))}`;switch(t){case"svg":return o;case"png":let a=await e9(o),l=document.createElement("canvas");return l.width=a.width,l.height=a.height,l.getContext("2d").drawImage(a,0,0),new Promise(t=>{l.toBlob(e=>t(URL.createObjectURL(e)),"image/png")})}}download(t){let e=document.createElement("a");e.download=s.name,e.href=t,e.click()}};async function e9(t){let e=new Image;return e.src=t,new Promise(t=>{e.onload=()=>t(e)})}var e8=class extends tQ{constructor(){super(new eL,"Image")}get format(){return this.node.querySelector(".format")}async save(){let t=await this.backend.save(this.format.value);this.backend.download(t)}load(){}},eI="https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.install",eT="767837575056-h87qmlhmhb3djhaaqta5gv2v3koa9hii.apps.googleusercontent.com",eN="AIzaSyCzu1qVxlgufneOYpBgDJXN6Z9SNVcHYWM",eD=class extends ei{constructor(){super("gdrive"),this.fileId=null}reset(){this.fileId=null}async save(t,e,i){await eK(),this.fileId=await this.send(t,e,i)}send(t,e,i){var s="/upload/drive/v2/files",n="POST";this.fileId&&(s+="/"+this.fileId,n="PUT");var r="b"+Math.random(),o="--"+r,a=[o,"Content-Type: application/json","",JSON.stringify({title:e}),o,"Content-Type: "+i,"",t,o+"--"].join("\r\n"),l=gapi.client.request({path:s,method:n,headers:{"Content-Type":"multipart/mixed; boundary='"+r+"'"},body:a});return new Promise((t,e)=>{l.execute(i=>{i?i.error?e(i.error):t(i.id):e(Error("Failed to upload to Google Drive"))})})}async load(t){await eK(),this.fileId=t;var e=gapi.client.request({path:"/drive/v2/files/"+this.fileId,method:"GET"});return new Promise((t,i)=>{e.execute(async e=>{if(!e||!e.id)return i(e&&e.error||Error("Failed to download file"));let s=await fetch(`https://www.googleapis.com/drive/v2/files/${e.id}?alt=media`,{headers:{Authentication:"Bearer "+gapi.auth.getToken().access_token}}),n=await s.text();if(200!=s.status)return i(n);t({data:n,name:e.title,mime:e.mimeType})})})}async pick(){await eK();var t=gapi.auth.getToken(),e=["application/json; charset=UTF-8","application/json"];[...eo.values()].forEach(t=>{t.mime&&e.unshift(t.mime)});var i=new google.picker.DocsView(google.picker.ViewId.DOCS).setMimeTypes(e.join(",")).setMode(google.picker.DocsViewMode.LIST);return new Promise(e=>{new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).addView(i).setOAuthToken(t.access_token).setDeveloperKey(eN).setCallback(t=>{switch(t[google.picker.Response.ACTION]){case google.picker.Action.PICKED:e(t[google.picker.Response.DOCUMENTS][0].id);break;case google.picker.Action.CANCEL:e(null)}}).build().setVisible(!0)})}};async function eK(){if(!("gapi"in window&&gapi.auth.getToken()))return await e0(),eO()}function e0(){if("gapi"in window)return;let t=document.createElement("script"),e=("cb"+Math.random()).replace(".","");return t.src="https://apis.google.com/js/client:picker.js?onload="+e,document.body.append(t),new Promise(t=>window[e]=t)}async function eO(t=!1){return new Promise((e,i)=>{gapi.auth.authorize({client_id:eT,scope:eI,immediate:!t},async s=>{if(s&&!s.error)e();else if(t)i(s&&s.error||Error("Failed to authorize with Google"));else try{await eO(!0),e()}catch(n){i(n)}})})}var eM,eq=class extends tQ{constructor(){super(new eD,"Google Drive"),eC(this.format),this.format.value=localStorage.getItem(`${this.prefix}.format`)||"native"}get format(){return this.node.querySelector(".format")}async save(){iX(!0);let t=eo.get(this.format.value),e=s.toJSON(),i=t.to(e),n=s.name,r="text/plain";t.mime?r=t.mime:n+="."+t.extension;try{await this.backend.save(i,n,r),this.saveDone()}catch(o){this.error(o)}}async load(){iX(!0);try{let t=await this.backend.pick();this.picked(t)}catch(e){this.error(e)}}async picked(t){if(iX(!1),t){iX(!0);try{let e=await this.backend.load(t),i=(eh(e.mime)||el(e.name)||eo.get("native")).from(e.data);this.loadDone(i)}catch(s){this.error(s)}}}setState(t){this.picked(t.id)}getState(){return{b:this.id,id:this.backend.fileId}}},eV=class extends tQ{constructor(){super(new class extends ei{constructor(){super("firebase"),this.current={id:null,name:null,data:null}}connect(t,e){if(firebase.initializeApp({apiKey:"AIzaSyBO_6uCK8pHjoz1c9htVwZi6Skpm8o4LtQ",authDomain:"my-mind.firebaseapp.com",databaseURL:"https://"+t+".firebaseio.com",projectId:"firebase-my-mind",storageBucket:"firebase-my-mind.appspot.com",messagingSenderId:"666556281676"}),this.ref=firebase.database().ref(),this.ref.child("names").on("value",t=>{f("firebase-list",this,t.val()||{})},this),e)return this.login(e)}save(t,e,i){return this.ref.child("names/"+e).set(i),new Promise((i,s)=>{this.ref.child("data/"+e).set(t,n=>{n?s(n):(i(),this.listenStart(t,e))})})}load(t){return new Promise((e,i)=>{this.ref.child("data/"+t).once("value",s=>{var n=s.val();n?(e(n),this.listenStart(n,t)):i(Error("There is no such saved map"))})})}remove(t){return this.ref.child("names/"+t).remove(),new Promise((e,i)=>{this.ref.child("data/"+t).remove(t=>{t?i(t):e()})})}reset(){this.listenStop()}mergeWith(t,e){let i=this.current.id;e!=this.current.name&&(this.current.name=e,this.ref.child("names/"+i).set(e));var s=this.ref.child("data/"+i),n=this.current.data;this.listenStop(),this.recursiveRefMerge(s,n,t),this.listenStart(t,i)}recursiveRefMerge(t,e,i){let s={};if(i instanceof Array){for(var n=0;n<i.length;n++){var r=i[n];n in e?"object"==typeof r?this.recursiveRefMerge(t.child(n),e[n],r):r!==e[n]&&(s[n]=r):s[n]=r}for(var n=i.length;n<e.length;n++)s[n]=null}else{for(var o in i){var r=i[o];o in e?"object"==typeof r?this.recursiveRefMerge(t.child(o),e[o],r):r!==e[o]&&(s[o]=r):s[o]=r}for(var o in e)o in i||(s[o]=null)}Object.keys(s).length&&t.update(s)}listenStart(t,e){(!this.current.id||this.current.id!=e)&&(this.listenStop(),this.current.id=e,this.current.data=t,this.ref.child("data/"+e).on("value",this.onValueChange,this))}listenStop(){this.current.id&&(this.ref.child("data/"+this.current.id).off("value"),this.current.id=null,this.current.name=null,this.current.data=null)}onValueChange(t){this.current.data=t.val(),clearTimeout(this.changeTimeout),this.changeTimeout=setTimeout(()=>{f("firebase-change",this,this.current.data)},200)}async login(t){var e;switch(t){case"github":e=new firebase.auth.GithubAuthProvider;break;case"facebook":e=new firebase.auth.FacebookAuthProvider;break;case"twitter":e=new firebase.auth.TwitterAuthProvider;break;case"google":e=new firebase.auth.GoogleAuthProvider}return(await firebase.auth().signInWithPopup(e)).user}},"Firebase"),this.online=!1;let{server:t,auth:e,remove:i,go:s}=this;t.value=localStorage.getItem(`${this.prefix}.server`)||"my-mind",e.value=localStorage.getItem(`${this.prefix}.auth`)||"",s.disabled=!1,i.addEventListener("click",async t=>{var e=this.list.value;if(e){iX(!0);try{await this.backend.remove(e),iX(!1)}catch(i){this.error(i)}}}),m("firebase-list",this),m("firebase-change",this)}get auth(){return this.node.querySelector(".auth")}get server(){return this.node.querySelector(".server")}get remove(){return this.node.querySelector(".remove")}get list(){return this.node.querySelector(".list")}async setState(t){try{await this.connect(t.s,t.a),this.load(t.id)}catch(e){this.error(e)}}getState(){var t={id:s.id,b:this.id,s:this.server.value};return this.auth.value&&(t.a=this.auth.value),t}show(t){super.show(t),this.sync()}handleMessage(t,e,i){switch(t){case"firebase-list":if(this.list.innerHTML="",Object.keys(i).length)ee(i,this.list);else{var n=document.createElement("option");n.innerHTML="(no maps saved)",this.list.appendChild(n)}this.sync();break;case"firebase-change":i?(g("item-change",this),s.mergeWith(i),m("item-change",this)):console.log("remote data disappeared");break;case"item-change":clearTimeout(this.itemChangeTimeout),this.itemChangeTimeout=setTimeout(()=>this.onItemChange(),200)}}reset(){this.backend.reset(),g("item-change",this)}onItemChange(){var t=s;this.backend.mergeWith(t.toJSON(),t.name)}submit(){if(!this.online){this.connect(this.server.value,this.auth.value);return}super.submit()}async save(){iX(!0);var t=s;try{await this.backend.save(t.toJSON(),t.id,t.name),this.saveDone(),m("item-change",this)}catch(e){this.error(e)}}async load(t=this.list.value){iX(!0);try{let e=await this.backend.load(t);this.loadDone(e),m("item-change",this)}catch(i){this.error(i)}}async connect(t,e){this.server.value=t,this.auth.value=e||"",this.server.disabled=!0,this.auth.disabled=!0,localStorage.setItem(`${this.prefix}.server`,t),localStorage.setItem(`${this.prefix}.auth`,e||""),this.go.disabled=!0,iX(!0),await this.backend.connect(t,e),iX(!1),this.online=!0,this.sync()}sync(){if(!this.online){this.go.textContent="Connect";return}this.go.disabled=!1,"load"!=this.mode||this.list.value||(this.go.disabled=!0),this.go.textContent=this.mode.charAt(0).toUpperCase()+this.mode.substring(1)}},eR="load",ez=null,eB=document.querySelector("#io"),eH=eB.querySelector("#backend"),eP="mm.app";function ej(){return eB.contains(document.activeElement)}function eJ(){[eu,eV,eq,eA,eE,e8].forEach(t=>{let e=new t;eH.append(e.option)}),eH.value=localStorage.getItem(`${eP}.backend`)||"file",eH.addEventListener("change",eG),m("map-new",t=>e7(null)),m("save-done",eF),m("load-done",eF)}function eF(t,e){e4(),e7(e)}function eW(){let t={};location.search.substring(1).split("&").forEach(e=>{let i=e.split("=").map(decodeURIComponent);t[i[0]]=i[1]}),"map"in t&&(t.url=t.map),"url"in t&&!("b"in t)&&(t.b="webdav");let e=et.get(t.b);if(e){e.setState(t);return}if(t.state){try{var i=JSON.parse(t.state);"open"==i.action?(i={b:"gdrive",id:i.ids[0]},et.get("gdrive").setState(i)):history.replaceState(null,"",".")}catch(s){}return}iX(!1)}function eU(t){eR=t,eB.hidden=!1,eB.querySelector("h3").textContent=t,eG()}function e4(){eB.hidden=!0}function e3(){ez?ez.save():eU("save")}function eG(){[...eB.querySelectorAll("div[id]")].forEach(t=>t.hidden=!0),eB.querySelector(`#${eH.value}`).hidden=!1,et.get(eH.value).show(eR)}function e7(t){ez&&ez!=t&&ez.reset(),t&&localStorage.setItem(`${eP}.backend`,t.id),ez=t;try{e1()}catch(e){}}function e1(){let t=ez&&ez.getState();if(t){let e=Object.entries(t).map(t=>t.map(encodeURIComponent).join("="));history.replaceState(null,"","?"+e.join("&"))}else history.replaceState(null,"",".")}var eY=document.querySelector("#context-menu");function e6(e){t=e,[...eY.querySelectorAll("[data-command]")].forEach(t=>{let e=t.dataset.command;t.textContent=il.get(e).label}),t.addEventListener("mousedown",eX),eY.addEventListener("mousedown",eX),eZ()}function e5(e){eY.hidden=!1;let i=eY.offsetWidth,s=eY.offsetHeight,n=e[0],r=e[1];n>t.offsetWidth/2&&(n-=i),r>t.offsetHeight/2&&(r-=s),eY.style.left=`${n}px`,eY.style.top=`${r}px`}function eX(t){if(t.currentTarget!=eY){eZ();return}t.stopPropagation(),t.preventDefault();let e=t.target.dataset.command;if(!e)return;let i=il.get(e);i.isValid&&(i.execute(),eZ())}function eZ(){eY.hidden=!0}var e2=document.querySelector("#ui");function eQ(){return e2.contains(document.activeElement)||ej()}function it(){e2.hidden=!e2.hidden,f("ui-change")}function ie(){return e2.hidden?0:e2.offsetWidth}function ii(){[tm,tO,tT,tc,tW].forEach(t=>t.update())}function is(t){let e=t.target;if(e==e2.querySelector("#toggle")){it();return}let i=e;for(;;){let s=i.dataset.command;if(s){il.get(s).execute();return}if(!(i.parentNode instanceof Element))return;i=i.parentNode}}function ir(t){[tm,tO,tT,tc,tW,z,to,C,t6,D,t2].forEach(t=>t.init()),e6(t),m("item-select",ii),m("item-change",(t,e)=>{e==n&&ii()}),e2.addEventListener("click",is),eW()}var io=15;function ia(){return!!navigator.platform.match(/mac/i)}var il=new Map,ih=class{constructor(t,e){this.label=e,this.editMode=!1,il.set(t,this)}get isValid(){return null===this.editMode||this.editMode==i1}};new class t extends ih{constructor(){super("notes","Notes"),this.keys=[{code:"KeyM",ctrlKey:!0}]}execute(){M()}},new class t extends ih{constructor(){super("undo","Undo"),this.keys=[{code:"KeyZ",ctrlKey:!0}]}get isValid(){return super.isValid&&_()}execute(){$()}},new class t extends ih{constructor(){super("redo","Redo"),this.keys=[{code:"KeyY",ctrlKey:!0}]}get isValid(){return super.isValid&&S()}execute(){b()}},new class t extends ih{constructor(){super("insert-sibling","Insert a sibling"),this.keys=[{code:"Enter"}]}execute(){let t=n,e;if(t.isRoot)e=new P(t,t.children.length);else{let i=t.parent,s=i.children.indexOf(t);e=new P(i,s+1)}i6(e),il.get("edit").execute(),f("command-sibling")}},new class t extends ih{constructor(){super("insert-child","Insert a child"),this.keys=[{code:"Tab",ctrlKey:!1},{code:"Insert"}]}execute(){let t=n,e=new P(t,t.children.length);i6(e),il.get("edit").execute(),f("command-child")}},new class t extends ih{constructor(){super("delete","Delete an item"),this.keys=[{code:ia()?"Backspace":"Delete"}]}get isValid(){return super.isValid&&!n.isRoot}execute(){let t=new J(n);i6(t)}},new class t extends ih{constructor(){super("swap","Swap sibling"),this.keys=[{code:"ArrowUp",ctrlKey:!0},{code:"ArrowDown",ctrlKey:!0}]}execute(t){let e=n;if(e.isRoot||e.parent.children.length<2)return;let i="ArrowUp"==t.code?-1:1,s=new W(e,i);i6(s)}},new class t extends ih{constructor(){super("side","Change side"),this.keys=[{code:"ArrowLeft",ctrlKey:!0},{code:"ArrowRight",ctrlKey:!0}]}execute(t){let e=n;if(e.isRoot||!e.parent.isRoot)return;let i="ArrowLeft"==t.code?"left":"right",s=new ti(n,i);i6(s)}},new class t extends ih{constructor(){super("save","Save map"),this.keys=[{code:"KeyS",ctrlKey:!0,shiftKey:!1}]}execute(){e3()}},new class t extends ih{constructor(){super("save-as","Save as…"),this.keys=[{code:"KeyS",ctrlKey:!0,shiftKey:!0}]}execute(){eU("save")}},new class t extends ih{constructor(){super("load","Load map"),this.keys=[{code:"KeyO",ctrlKey:!0}]}execute(){eU("load")}},new class t extends ih{constructor(){super("center","Center map"),this.keys=[{code:"End"}]}execute(){s.center()}},new class t extends ih{constructor(){super("new","New map"),this.keys=[{code:"KeyN",ctrlKey:!0}]}execute(){confirm("Throw away your current map and start a new one?")&&(iY(new i_),f("map-new",this))}},new class t extends ih{constructor(){super("zoom-in","Zoom in"),this.keys=[{key:"+"}]}execute(){s.adjustFontSize(1)}},new class t extends ih{constructor(){super("zoom-out","Zoom out"),this.keys=[{key:"-"}]}execute(){s.adjustFontSize(-1)}},new class t extends ih{constructor(){super("help","Show/hide help"),this.keys=[{key:"?"}]}execute(){E()}},new class t extends ih{constructor(){super("ui","Show/hide UI"),this.keys=[{key:"*"}]}execute(){it()}},new class t extends ih{constructor(){super("pan","Pan the map"),this.keys=[{code:"KeyW",ctrlKey:!1,altKey:!1,metaKey:!1},{code:"KeyA",ctrlKey:!1,altKey:!1,metaKey:!1},{code:"KeyS",ctrlKey:!1,altKey:!1,metaKey:!1},{code:"KeyD",ctrlKey:!1,altKey:!1,metaKey:!1}],this.codes=[]}execute(t){let{code:e}=t;!(this.codes.indexOf(e)>-1)&&(this.codes.length||(window.addEventListener("keyup",this),this.interval=setInterval(()=>this.step(),50)),this.codes.push(e),this.step())}step(){let t={KeyW:[0,1],KeyA:[1,0],KeyS:[0,-1],KeyD:[-1,0]},e=[0,0];this.codes.forEach(i=>{e[0]+=t[i][0]*io,e[1]+=t[i][1]*io}),s.moveBy(e)}handleEvent(t){let{code:e}=t;var i=this.codes.indexOf(e);i>-1&&(this.codes.splice(i,1),this.codes.length||(window.removeEventListener("keyup",this),clearInterval(this.interval)))}},new class t extends ih{constructor(){super("fold","Fold/Unfold"),this.keys=[{key:"f",ctrlKey:!1}]}execute(){let t=n;t.collapsed=!t.collapsed,s.ensureItemVisibility(t)}};var ic=6,id={parent:!0,children:!1},iu=class{constructor(){this._id=im(),this._parent=null,this._collapsed=!1,this._icon="",this._notes="",this._color="",this._textColor="",this._value=null,this._status=null,this._side=null,this._shape=new tz,this._layout=null,this.originalText="",this.dom={node:d(),connectors:d(),content:l("div"),notes:l("div"),status:l("span"),icon:l("span"),value:l("span"),text:l("div"),toggle:iy()},this.children=[];let{dom:t}=this;t.node.classList.add("item"),t.content.classList.add("content"),t.notes.classList.add("notes"),t.status.classList.add("status"),t.icon.classList.add("icon"),t.value.classList.add("value"),t.text.classList.add("text"),t.icon.classList.add("icon"),this.notes="";let e=u();t.node.append(t.connectors,e),e.append(t.content),t.content.append(t.status,t.value,t.icon,t.text,t.notes),t.toggle.addEventListener("click",t=>{this.collapsed=!this.collapsed,i5(this)}),this.updateToggle()}static fromJSON(t){return new this().fromJSON(t)}get id(){return this._id}get parent(){return this._parent}set parent(t){this._parent=t,this.update({children:!0})}get size(){let t=this.dom.node.getBBox();return[t.width,t.height]}get position(){let{node:t}=this.dom,e=t.getAttribute("transform");return e.match(/\d+/g).map(Number)}set position(t){let{node:e}=this.dom,i=`translate(${t.join(" ")})`;e.setAttribute("transform",i)}get contentSize(){let{content:t}=this.dom,e=t.parentNode;return[e.getAttribute("width"),e.getAttribute("height")].map(Number)}get contentPosition(){let{content:t}=this.dom,e=t.parentNode;return[e.getAttribute("x"),e.getAttribute("y")].map(Number)}set contentPosition(t){let{content:e}=this.dom,i=e.parentNode;i.setAttribute("x",String(t[0])),i.setAttribute("y",String(t[1]))}toJSON(){let t={id:this.id,text:this.text,notes:this.notes};return this._side&&(t.side=this._side),this._color&&(t.color=this._color),this._textColor&&(t.textColor=this._textColor),this._icon&&(t.icon=this._icon),null!==this._value&&(t.value=this._value),null!==this._status&&(t.status=this._status),this._layout&&(t.layout=this._layout.id),this._shape&&(t.shape=this._shape.id),this._collapsed&&(t.collapsed=!0),this.children.length&&(t.children=this.children.map(t=>t.toJSON())),t}fromJSON(t){return this.text=t.text,t.id&&(this._id=t.id),t.notes&&(this.notes=t.notes),t.side&&(this._side=t.side),t.color&&(this._color=t.color),t.textColor&&(this._textColor=t.textColor),t.icon&&(this._icon=t.icon),void 0!==t.value&&(this._value=t.value),void 0!==t.status&&("yes"==t.status?this._status=!0:"no"==t.status?this._status=!1:this._status=t.status),t.collapsed&&(this.collapsed=!!t.collapsed),t.layout&&(this._layout=ty.get(t.layout)),t.shape&&(this.shape=tR.get(t.shape)),(t.children||[]).forEach(t=>{this.insertChild(iu.fromJSON(t))}),this}mergeWith(t){var e=0;this.text==t.text||this.dom.text.contentEditable||(this.text=t.text),this._side!=t.side&&(this._side=t.side||null,e=1),this._color!=t.color&&(this._color=t.color||"",e=2),this._textColor!=t.textColor&&(this._textColor=t.textColor||"",e=2),this._icon!=t.icon&&(this._icon=t.icon||"",e=1),this._value!=t.value&&(this._value=t.value||null,e=1),this._status!=t.status&&(this._status=t.status,e=1),!!t.collapsed!=this._collapsed&&(this.collapsed=!!t.collapsed);(this._shape?this._shape.id:null)!=t.shape&&(this._shape=t.shape?tR.get(t.shape):null,e=1);(this._layout?this._layout.id:null)!=t.layout&&(this._layout=t.layout?ty.get(t.layout):null,e=2),(t.children||[]).forEach((t,e)=>{if(e>=this.children.length)this.insertChild(iu.fromJSON(t));else{var i=this.children[e];i.id==t.id?i.mergeWith(t):(this.removeChild(this.children[e]),this.insertChild(iu.fromJSON(t),e))}});let i=(t.children||[]).length;for(;this.children.length>i;)this.removeChild(this.children[this.children.length-1]);1==e&&this.update({children:!1}),2==e&&this.update({children:!0})}clone(){var t=this.toJSON(),e=function(t){delete t.id,t.children&&t.children.forEach(e)};return e(t),iu.fromJSON(t)}select(){this.dom.node.classList.add("current"),f("item-select",this)}deselect(){this.dom.node.classList.remove("current")}update(t={}){t=Object.assign({},id,t);let{map:e,children:i,parent:s}=this;if(!e||!e.isVisible)return;if(t.children){let n={parent:!1,children:!0};i.forEach(t=>t.update(n))}f("item-change",this),this.updateStatus(),this.updateIcon(),this.updateValue();let{resolvedLayout:r,resolvedShape:o,dom:a}=this,{content:l,node:h,connectors:c}=a;a.text.style.color=this.resolvedTextColor,h.dataset.shape=o.id,h.dataset.align=r.computeAlignment(this);let d=l.parentNode,u=[Math.max(l.offsetWidth,l.scrollWidth),Math.max(l.offsetHeight,l.scrollHeight)];d.setAttribute("width",String(u[0])),d.setAttribute("height",String(u[1])),c.innerHTML="",r.update(this),o.update(this),t.parent&&s&&s.update({children:!1})}get text(){return this.dom.text.innerHTML}set text(t){let e=t.toString();console.log("rawat",e),this.dom.text.innerHTML=t,ip(this.dom.text),this.update()}get notes(){return this._notes}set notes(t){this._notes=t,this.dom.notes.hidden=!t}get collapsed(){return this._collapsed}set collapsed(t){this._collapsed=t,this.updateToggle(),this.update({children:!t})}get value(){return this._value}set value(t){this._value=t,this.update()}get resolvedValue(){let t=this._value;if("number"==typeof t)return t;let e=this.children.map(t=>t.resolvedValue);switch(t){case"max":return Math.max(...e);case"min":return Math.min(...e);case"sum":return e.reduce((t,e)=>t+e,0);case"avg":var i=e.reduce((t,e)=>t+e,0);return e.length?i/e.length:0;default:return 0}}get status(){return this._status}set status(t){this._status=t,this.update()}get resolvedStatus(){let t=this._status;return"computed"==t?this.children.every(t=>!1!==t.resolvedStatus):t}get icon(){return this._icon}set icon(t){this._icon=t,this.update()}get side(){return this._side}set side(t){this._side=t}get color(){return this._color}set color(t){this._color=t,this.update({children:!0})}get resolvedColor(){if(this._color)return this._color;let{parent:t}=this;return t instanceof iu?t.resolvedColor:ix}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this.update({children:!0})}get resolvedTextColor(){if(this._textColor)return this._textColor;let{parent:t}=this;return t instanceof iu?t.resolvedTextColor:""}get layout(){return this._layout}set layout(t){this._layout=t,this.update({children:!0})}get resolvedLayout(){if(this._layout)return this._layout;let{parent:t}=this;if(!(t instanceof iu))throw Error("Non-connected item does not have layout");return t.resolvedLayout}get shape(){return this._shape}set shape(t){this._shape=t,this.update()}get resolvedShape(){if(this._shape)return this._shape;let t=0,e=this;for(;!e.isRoot;)t++,e=e.parent;switch(t){case 0:return tR.get("ellipse");case 1:return tR.get("box");default:return tR.get("underline")}}get map(){let t=this.parent;for(;t;){if(t instanceof i_)return t;t=t.parent}return null}get isRoot(){return this.parent instanceof i_}insertChild(t,e){t.originalText="tanu",t?t.parent&&t.parent:(t=new iu).originalText="tanu",this.children.length||this.dom.node.appendChild(this.dom.toggle),void 0===e&&(e=this.children.length);var i=null;e<this.children.length&&(i=this.children[e].dom.node),this.dom.node.insertBefore(t.dom.node,i),this.children.splice(e,0,t),t.parent=this}removeChild(t){this.children.indexOf(t);//!this.children.length && this.dom.toggle.remove();
}startEditing(){this.originalText=this.text,this.dom.text.contentEditable="true",this.dom.text.focus(),document.execCommand("styleWithCSS",!1,"false"),this.dom.text.addEventListener("input",this),this.dom.text.addEventListener("keydown",this),this.dom.text.addEventListener("blur",this)}stopEditing(){this.dom.text.removeEventListener("input",this),this.dom.text.removeEventListener("keydown",this),this.dom.text.removeEventListener("blur",this),this.dom.text.blur(),this.dom.text.contentEditable="false";let t=this.dom.text.innerHTML;return this.dom.text.innerHTML=this.originalText,this.originalText="",this.update(),t}handleEvent(t){switch(t.type){case"input":this.update(),this.map.ensureItemVisibility(this);break;case"keydown":"Tab"==t.code&&t.preventDefault();break;case"blur":il.get("finish").execute()}}updateStatus(){let{resolvedStatus:t,dom:e}=this;switch(e.status.className="status",e.status.hidden=!1,t){case!0:e.status.classList.add("yes");break;case!1:e.status.classList.add("no");break;default:e.status.hidden=!0}}updateIcon(){var t=this._icon;this.dom.icon.className="icon",this.dom.icon.hidden=!t,t&&(this.dom.icon.classList.add("fa"),this.dom.icon.classList.add(t))}updateValue(){let{dom:t,_value:e}=this;if(null===e){t.value.hidden=!0;return}if(t.value.hidden=!1,"number"==typeof e)t.value.textContent=String(e);else{let i=this.resolvedValue;t.value.textContent=String(Math.round(i)==i?i:i.toFixed(3))}}updateToggle(){let{node:t,toggle:e}=this.dom;t.classList.toggle("collapsed",this._collapsed),e.querySelector("path").setAttribute("d",this._collapsed?iv:ig)}};function ip(t){let e=[...t.childNodes];for(let i=0;i<e.length;i++){let s=e[i];if(s instanceof Element){if("a"==s.nodeName.toLowerCase())continue;ip(s)}if(s instanceof Text){let n=s.nodeValue,r=n.match(iw);if(!r)continue;let o=n.substring(0,r.index),a=n.substring(r.index+r[0].length);var l=document.createElement("a");l.innerHTML=l.href=r[0],l.setAttribute("style","text-decoration:none"),o&&t.insertBefore(document.createTextNode(o),s),t.insertBefore(l,s),a?(s.nodeValue=a,i--):s.remove()}}}function im(){let t="";for(var e=0;e<8;e++)t+=String.fromCharCode(97+Math.floor(26*Math.random()));return t}var ig=`M ${-(ic-2)} 0 L ${ic-2} 0`,iv=`${ig} M 0 ${-(ic-2)} L 0 ${ic-2}`;function iy(){let t={cx:"0",cy:"0",r:String(ic)},e=d();return e.classList.add("toggle"),e.append(c("circle",t),c("path")),e}var ix="#999",iw=/\b(([a-z][\w-]+:\/\/\w)|(([\w-]+\.){2,}[a-z][\w-]+)|([\w-]+\.[a-z][\w-]+\/))[^\s]*([^\s,.;:?!<>\(\)\[\]'"])?($|\b)/i,i$="",ib={children:!0},i_=class{constructor(t){this.node=c("svg"),this.style=l("style"),this.position=[0,0],this.fontSize=15;let e=Object.assign({root:"My Mind Map",layout:ty.get("map")},t);this.style.textContent=i$,this.node.style.fontSize=`${this.fontSize}px`;let i=new iu;i.text=e.root,i.layout=e.layout,this.root=i}static fromJSON(t){return new this().fromJSON(t)}toJSON(){return{root:this._root.toJSON()}}fromJSON(t){return this.root=iu.fromJSON(t.root),this}get root(){return this._root}set root(t){let{node:e,style:i}=this;this._root=t,e.innerHTML="",e.append(t.dom.node,i),t.parent=this}adjustFontSize(t){this.fontSize=Math.max(8,this.fontSize+2*t),this.node.style.fontSize=`${this.fontSize}px`,this.update(),this.ensureItemVisibility(n)}mergeWith(t){let e=[];for(var i=n,s=i;e.push(s.id),s.parent!=this;)s=s.parent;if(this._root.mergeWith(t.root),i.map){let r=i,o=!1;for(;r.parent!=this;)(r=r.parent).collapsed&&(o=!0);if(!o)return}i1&&i2();var a={},l=function(t){a[t.id]=t,t.children.forEach(l)};for(l(this._root);e.length;){var h=e.shift();if(h in a){i5(a[h]);return}}}get isVisible(){return!!this.node.parentNode}update(t){(t=Object.assign({},ib,t)).children&&this._root.update({parent:!1,children:!0});let{node:e}=this,{size:i}=this._root;e.setAttribute("width",String(i[0])),e.setAttribute("height",String(i[1]))}show(t){t.append(this.node),this.update(),this.center(),i5(this._root)}hide(){this.node.remove()}center(){let{size:t}=this._root,e=this.node.parentNode,i=[(e.offsetWidth-t[0])/2,(e.offsetHeight-t[1])/2].map(Math.round);this.moveTo(i)}moveBy(t){let e=this.position.map((e,i)=>e+t[i]);return this.moveTo(e)}getClosestItem(t){let e=[];return!function i(s){let n=s.dom.content.getBoundingClientRect(),r=n.left+n.width/2-t[0],o=n.top+n.height/2-t[1];e.push({dx:r,dy:o,item:s,distance:r*r+o*o}),s.collapsed||s.children.forEach(i)}(this._root),e.sort((t,e)=>t.distance-e.distance),e[0]}getItemFor(t){let e=t.closest(".content");if(e)return function t(i){if(i.dom.content==e)return i;for(let s of i.children){let n=t(s);if(n)return n}}(this._root)}ensureItemVisibility(t){let e=t.dom.content.getBoundingClientRect();var i=this.node.parentNode.getBoundingClientRect(),s=[0,0],n=i.left-e.left+10;n>0&&(s[0]=n);var n=i.right-e.right-10;n<0&&(s[0]=n);var r=i.top-e.top+10;r>0&&(s[1]=r);var r=i.bottom-e.bottom-10;r<0&&(s[1]=r),(s[0]||s[1])&&this.moveBy(s)}get name(){return ed(this._root.text).replace(/\n/g," ").replace(/<.*?>/g,"").trim()}get id(){return this._root.id}pick(t,e){let i=[];var s=t.dom.content.getBoundingClientRect();return(this.getPickCandidates(s,this._root,e,i),i.length)?(i.sort((t,e)=>t.dist-e.dist),i[0].item):t}getPickCandidates(t,e,i,s){e.collapsed||e.children.forEach(e=>{this.getPickCandidates(t,e,i,s)});var n=e.dom.content.getBoundingClientRect();if("left"==i||"right"==i){var r=t.left+t.width/2,o=n.left+n.width/2;if("left"==i&&o>r||"right"==i&&o<r)return;var a=t.top-n.bottom,l=n.top-t.bottom,h=Math.abs(o-r)}else{var c=t.top+t.height/2,d=n.top+n.height/2;if("top"==i&&d>c||"bottom"==i&&d<c)return;var a=t.left-n.right,l=n.left-t.right,h=Math.abs(d-c)}var u=Math.max(a,l);!(u>0)&&h&&!(h<u)&&s.push({item:e,dist:h})}moveTo(t){this.position=t,this.node.style.left=`${t[0]}px`,this.node.style.top=`${t[1]}px`}};async function iS(){i$=await (await fetch("map.css")).text()}function iC(t){if(eQ())return;let e=[...il.values()].find(e=>!!e.isValid&&e.keys.find(e=>iA(e,t)));e&&(t.preventDefault(),e.execute(t))}function ik(){window.addEventListener("keydown",iC)}function iA(t,e){return Object.entries(t).every(([t,i])=>e[t]==i)}var iE=500,iL=5,i9={mode:"",cursor:[],item:null,ghost:null,ghostPosition:[],previousDragState:null};function i8(t){(i=t).addEventListener("touchstart",iI),i.addEventListener("mousedown",iI),i.addEventListener("click",t=>{let e=s.getItemFor(t.target);(!i1||e!=n)&&e&&i5(e)}),i.addEventListener("dblclick",t=>{s.getItemFor(t.target)&&il.get("edit").execute()}),i.addEventListener("wheel",t=>{let{deltaY:e}=t;e&&s.adjustFontSize(e>0?-1:1)}),i.addEventListener("contextmenu",t=>{iN(t),t.preventDefault();let e=s.getItemFor(t.target);e&&i5(e),e5([t.clientX,t.clientY])})}function iI(t){let r=iq(t);if(!r)return;let o=s.getItemFor(t.target);if(i1){if(o==n)return;il.get("finish").execute()}document.activeElement.blur(),i9.cursor=r,o&&!o.isRoot?(i9.mode="drag",i9.item=o):(i9.mode="pan",i.style.cursor="move"),"mousedown"==t.type&&(t.preventDefault(),i.addEventListener("mousemove",iT),i.addEventListener("mouseup",iN)),"touchstart"==t.type&&(e=setTimeout(function(){o&&i5(o),e5(r)},iE),i.addEventListener("touchmove",iT),i.addEventListener("touchend",iN))}function iT(t){let n=iq(t);if(!n)return;clearTimeout(e),t.preventDefault();let r=[n[0]-i9.cursor[0],n[1]-i9.cursor[1]];switch(i9.cursor=n,i9.mode){case"drag":i9.ghost||(i.style.cursor="move",iD(i9.item)),iK(r);iM(iO());break;case"pan":s.moveBy(r)}}function iN(t){clearTimeout(e),i.style.cursor="",i.removeEventListener("mousemove",iT),i.removeEventListener("mouseup",iN);let{mode:s,ghost:n}=i9;"pan"!=s&&(n&&(i0(iO()),n.remove(),i9.ghost=null),i9.item=null)}function iD(t){let{content:e}=t.dom,s=e.cloneNode(!0);s.classList.add("ghost"),i.append(s);let n=e.getBoundingClientRect();i9.ghost=s,i9.ghostPosition=[n.left,n.top]}function iK(t){let{ghostPosition:e}=i9,i=i9.ghost;e[0]+=t[0],e[1]+=t[1],i.style.left=`${e[0]}px`,i.style.top=`${e[1]}px`}function i0(t){iM(null);let{target:e,result:i,direction:s}=t,n;switch(i){case"append":n=new F(i9.item,e);break;case"sibling":let r=e,o=r.parent.children.indexOf(r);n=new F(i9.item,r.parent,o+("right"==s||"bottom"==s?1:0),r.side)}i6(n)}function iO(){let t=i9.ghost.getBoundingClientRect(),e=[t.left+t.width/2,t.top+t.height/2],i=s.getClosestItem(e),n=i.item,r={result:"",target:n,direction:"left"},o=n;for(;!o.isRoot;){if(o==i9.item)return r;o=o.parent}let a=i9.item.contentSize,l=n.contentSize,h=Math.max(a[0],l[0]),c=Math.max(a[1],l[1]);if(n.isRoot)r.result="append";else if(Math.abs(i.dx)<h&&Math.abs(i.dy)<c)r.result="append";else{r.result="sibling";let d=n.parent.resolvedLayout.getChildDirection(n);"left"==d||"right"==d?r.direction=i.dy<0?"bottom":"top":r.direction=i.dx<0?"right":"left"}return r}function iM(t){let{previousDragState:e}=i9;if(e&&t&&e.target==t.target&&e.result==t.result||(e&&(e.target.dom.content.style.boxShadow=""),!t))return;let i=0,s=0;"sibling"==t.result&&("left"==t.direction&&(i=-1),"right"==t.direction&&(i=1),"top"==t.direction&&(s=-1),"bottom"==t.direction&&(s=1));let n=i||s?-2:2;t.target.dom.content.style.boxShadow=`${i*iL}px ${s*iL}px 2px ${n}px #000`,i9.previousDragState=t}function iq(t){return"touches"in t?t.touches.length>1?null:[t.touches[0].clientX,t.touches[0].clientY]:[t.clientX,t.clientY]}var iV=null,iR="";function iz(){document.body.addEventListener("cut",iB),document.body.addEventListener("copy",iB),document.body.addEventListener("paste",iH)}function iB(t){if(eQ()||i1)return;switch(t.preventDefault(),iJ(),t.type){case"copy":iV=n.clone();break;case"cut":(iV=n).dom.node.classList.add("cut");break;default:return}let e=iV.toJSON(),i=eo.get("plaintext").to(e);t.clipboardData.setData("text/plain",i),iR=t.type}function iH(t){if(eQ()||i1)return;t.preventDefault();let e=t.clipboardData.getData("text/plain");e&&(iV&&e==eo.get("plaintext").to(iV.toJSON())?iP(iV,n):ij(e,n),iJ())}function iP(t,e){let i;switch(iR){case"cut":if(t==e||t.parent==e)return;let s=e;for(;;){if(s==t)return;if(s.parent instanceof i_)break;s=s.parent}i=new F(t,e),i6(i);break;case"copy":i=new j(e,t.clone()),i6(i)}}function ij(t,e){let i=eo.get("plaintext").from(t),s=i_.fromJSON(i).root;if(s.text){let n=new j(e,s);i6(n)}else{let r=s.children.map(t=>new j(e,t)),o=new H(r);i6(o)}}function iJ(){"cut"==iR&&(iV.dom.node.classList.remove("cut"),iV=null,iR="")}function iF(t,e){e.isRoot&&e.map==s&&(document.title=s.name+" :: My Mind")}function iW(){m("item-change",iF)}new class t extends ih{constructor(){super("select","Move selection"),this.keys=[{code:"ArrowLeft",ctrlKey:!1},{code:"ArrowUp",ctrlKey:!1},{code:"ArrowRight",ctrlKey:!1},{code:"ArrowDown",ctrlKey:!1}]}execute(t){let e={ArrowLeft:"left",ArrowUp:"top",ArrowRight:"right",ArrowDown:"bottom"}[t.code],i=n.resolvedLayout.pick(n,e);i5(i)}},new class t extends ih{constructor(){super("select-root","Select root"),this.keys=[{code:"Home"}]}execute(){let t=n;for(;!t.isRoot;)t=t.parent;i5(t)}},new class t extends ih{constructor(){super("select-parent","Select parent"),this.keys=[{code:"Backspace"}]}execute(){if(n.parent.isRoot)return;let t=n;void 0==t||t.isRoot||i5(t.parent),console.log("parent",t.parent.id)}},new class t extends ih{constructor(){super("edit","Edit item"),this.keys=[{code:"Space"},{code:"F2"}]}execute(){iZ()}},new class t extends ih{constructor(){super("finish","Finish editing"),this.keys=[{code:"Enter",altKey:!1,ctrlKey:!1,shiftKey:!1}],this.editMode=!0}execute(t){let e=i2(),i="";t&&t.title&&(e=t.url,i=t.title),console.log("setting the currTitle here so that if its called with same title it doesnt come here it stops in callFinish it"),sn=i;let s;s=e?new Z(n,e):new J(n),i6(s),n.dom.node.getElementsByTagName("a")[0].innerHTML=i}},new class t extends ih{constructor(){super("newline","Line break"),this.keys=[{code:"Enter",shiftKey:!0},{code:"Enter",ctrlKey:!0}],this.editMode=!0}execute(){let t=getSelection().getRangeAt(0),e=document.createElement("br");t.insertNode(e),t.setStartAfter(e),n.update({parent:!0,children:!0})}},new class t extends ih{constructor(){super("cancel","Cancel"),this.keys=[{code:"Escape"}],this.editMode=null}execute(){if(i1){if(i2(),!n.text){var t=new J(n);i6(t)}}else q(),N(),e4()}};var iU=class extends ih{constructor(){super(...arguments),this.editMode=null}execute(){if(i1)document.execCommand(this.command,!1);else{il.get("edit").execute();let t=getSelection(),e=t.getRangeAt(0);e.selectNodeContents(n.dom.text),t.removeAllRanges(),t.addRange(e),this.execute(),il.get("finish").execute()}}};new class t extends iU{constructor(){super("bold","Bold"),this.keys=[{code:"KeyB",ctrlKey:!0}],this.command="bold"}},new class t extends iU{constructor(){super("underline","Underline"),this.keys=[{code:"KeyU",ctrlKey:!0}],this.command="underline"}},new class t extends iU{constructor(){super("italic","Italic"),this.keys=[{code:"KeyI",ctrlKey:!0}],this.command="italic"}},new class t extends iU{constructor(){super("strikethrough","Strike-through"),this.keys=[{code:"KeyS",ctrlKey:!0}],this.command="strikeThrough"}},new class t extends ih{constructor(){super("value","Set value"),this.keys=[{key:"v",ctrlKey:!1,metaKey:!1}]}execute(){let t=n,e=prompt("Set item value",String(t.value));if(null==e)return;e.length||(e=null);let i=Number(e),s=new Q(t,isNaN(i)?e:i);i6(s)}},new class t extends ih{constructor(){super("yes","Yes"),this.keys=[{key:"y",ctrlKey:!1}]}execute(){let t=n,e=!0!==t.status||null,i=new tt(t,e);i6(i)}},new class t extends ih{constructor(){super("no","No"),this.keys=[{key:"n",ctrlKey:!1}]}execute(){let t=n,e=!1===t.status&&null,i=new tt(t,e);i6(i)}},new class t extends ih{constructor(){super("computed","Computed"),this.keys=[{key:"c",ctrlKey:!1,metaKey:!1}]}execute(){let t=n,e="computed"==t.status?null:"computed",i=new tt(t,e);i6(i)}};class i4{constructor(t){this.value=t,this.next=null}}class i3{constructor(){this.first=null,this.last=null,this.size=0}push(t){let e=new i4(t);if(this.first){let i=this.first;this.first=e,this.first.next=i}else this.first=e,this.last=e;return this.size++,this.size}pop(){if(!this.first)return null;let t=this.first;return this.first===this.last&&(this.last=null),this.first=this.first.next,this.size--,t.value}}var iG=document.querySelector("main"),i7=document.querySelector("#throbber"),i1=!1;function iY(t){s&&s.hide(),x(),(s=t).show(iG)}function i6(t){console.log(y),console.log(t),w(t),t.do()}function i5(t){n&&n!=t&&(i1&&il.get("finish").execute(),n.deselect()),void 0!=t&&((n=t).select(),s.ensureItemVisibility(n))}function iX(t){i7.hidden=!t}function iZ(){i1=!0,n.startEditing()}function i2(){return i1=!1,n.stopEditing()}async function iQ(){await iS(),m("ui-change",so),window.addEventListener("resize",so),window.addEventListener("beforeunload",t=>(t.preventDefault(),"")),iz(),ik(),i8(iG),iW(),ir(iG),so(),iY(new i_)}function st(t){if(null==t.title||""==t.title||sa==t.url)return;let e=il.get("insert-child"),i=new KeyboardEvent("key");e&&(e.execute(i),console.log("akash  successfully triggered an event"),console.log(t))}function se(t){if(!t.title)return;let e=il.get("edit"),i=new KeyboardEvent("key");e&&(e.execute(i),console.log("dikhsha  successfully triggered an event"),console.log(t),sa=t.url)}async function si(){let t=il.get("select-root");new KeyboardEvent("select root"),t&&(t.execute(),console.log(" selectted the root"))}async function ss(){let t=il.get("select-parent");new KeyboardEvent("select parent"),t&&(t.execute(),console.log(" selectted the parent"))}var sn="";function sr(t){let e=il.get("finish");new KeyboardEvent("finish"),e&&(e.execute(t),console.log("finishi  successfully triggered an event"),console.log(t))}function so(){let t=[window.innerWidth-ie(),window.innerHeight];iG.style.width=t[0]+"px",iG.style.height=t[1]+"px",s&&s.ensureItemVisibility(n)}iQ();var sa="",sl=0;let sh=0;var sc="";async function sd(t,e,i){if(await new Promise((t,e)=>setTimeout(t,3e3)),"complete"==i.status&&i.active&&null!=i.title&&""!=i.title&&i.title!=sn){if(null!=sp.first&&null!=sp.first.next&&(sp.first.next.value.dom.node.getElementsByTagName("a")[0].href==i.url||sp.first.value.dom.node.getElementsByTagName("a")[0].href==i.url)){let s=sp.first.value.dom.node.getElementsByTagName("a")[0].innerHTML;console.log(s,"the tab-title for topmost"),n.dom.node.getElementsByTagName("a")[0].href!=i.url&&ss(),await new Promise((t,e)=>setTimeout(t,1e3)),void 0!=i.id&&i.id>0&&sf.set(i.id,n),sp.pop()}else console.log("why child is added",sp),void 0!=n&&sp.push(n),sa!=i.url&&(st(i),se(i),sr(i),await new Promise((t,e)=>setTimeout(t,1e3)),sf.has(i.id)&&sf.delete(i.id),void 0!=i.id&&i.id>0&&sf.set(i.id,n));console.log(`Updated tab: ${t}`),console.log("Changed attributes: ",e),console.log("New tab Info: ",i.title),console.log(tabInfoCUrrent.title),console.log(i.title),flag=!0,console.log("the following needs to be un equal baby",sh,i.id,t),sh!=i.id&&(si(),console.log("the following are the updated tab results and root is being decidded"),console.log(sh,i.id)),console.log("time started"),console.log("time ended"),sc=i.url}}var su=0,sp=new i3;let sf=new Map;async function sm(t){try{sh=(tabInfoCUrrent=await browser.tabs.get(t.tabId)).id,sa=tabInfoCUrrent.url,sf.has(sh)?(i5(sf.get(sh)),await new Promise((t,e)=>setTimeout(t,1e3))):si(),console.log("we activated a new tab with tanino",sh)}catch(e){console.error(e)}}sf.set("a",1),sf.set("b",2),sf.set("c",3),console.log(sf.get("a")),sf.set("a",97),browser.tabs.onUpdated.addListener(sd),browser.tabs.onActivated.addListener(sm)})();